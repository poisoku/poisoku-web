# ポイントインカムスクレイピングシステム仕様書

## 概要
ポイントインカムのWebサイトから案件データを自動取得するスクレイピングシステム

## システム構成

### メインスクレイパー
- **ファイル**: `/scrapers/src/sites/pointincome/PointIncomeWebScraper.js`
- **対象カテゴリ**: 82カテゴリ（ショッピング50、サービス32）
- **取得実績**: 約1,649件の案件データ

### 主要機能
1. **全ページ自動取得**: 各カテゴリの全ページを「次へ>」ボタンがなくなるまで取得
2. **JavaScript対応ページネーション**: `tab_select()`関数によるAJAX遷移に対応
3. **高度なエラー耐性**: 
   - 接続エラー時の自動ブラウザ再起動
   - 各カテゴリ最大3回のリトライ
   - 5カテゴリごとの定期的ブラウザ再起動
4. **重複除去**: ID重複チェックによる案件の重複登録防止

## 技術仕様

### ページネーション処理
```javascript
// ポイントインカム特有のJavaScriptページネーション
window.tab_select('tab1', 0, 63, pageNumber);
```

### データ変換
- **ポイント→円換算**: 10pt = 1円
- **デバイス設定**: 全案件「すべて」（モバイルアプリ案件以外）

### エラーハンドリング
- Protocol errorやConnection closed時の自動復旧
- ページ内容変化の確実な検出（最大45秒待機）
- カテゴリ単位でのエラー分離

## 実行方法

### 全カテゴリ取得
```bash
node scrapers/src/sites/pointincome/PointIncomeWebScraper.js
```

### データ統合
```bash
node scripts/integrate-pointincome-data.js
```

## 出力データ形式
```json
{
  "id": "49384",
  "title": "ビックカメラ.com",
  "url": "https://pointi.jp/ad/49384/",
  "points": "1.8%",
  "device": "すべて",
  "category_id": 66,
  "category_type": "shopping",
  "timestamp": "2025-08-09T21:51:15.190Z"
}
```

## パフォーマンス
- **実行時間**: 約30-45分（全82カテゴリ）
- **ページ処理速度**: 1ページあたり約10-15秒
- **メモリ使用量**: 安定動作（定期的なブラウザ再起動により）

## 保守・運用

### 日常運用
- **推奨頻度**: 日次または週2-3回
- **実行時間帯**: サーバー負荷の低い深夜帯推奨

### トラブルシューティング
1. **接続エラー**: 自動的にブラウザ再起動で対応
2. **ページネーション失敗**: 最大45秒待機後、次カテゴリへ
3. **メモリ不足**: browserRestartInterval値を調整（デフォルト: 5）

## 今後の拡張性
- カテゴリIDの追加は`initializeCategories()`メソッドで簡単に対応可能
- ページネーション仕様変更時は`detectNextButton()`メソッドを調整

## 最適化履歴
- 2025-08-09: コード最適化実施
  - 不要なデバッグコード削除（58行削減）
  - 関数の分離によるメンテナンス性向上
  - 設定値の集約による管理性向上